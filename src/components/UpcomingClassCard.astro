---
import { documentToHtmlString } from "@contentful/rich-text-html-renderer";

import type { ClassListing } from "~/api/getClassListings";

import CoralButtonLink from "./CoralButtonLink.astro";
import LinkedImage from "./LinkedImage.astro";
import { formatClassDateRange } from "~/utils/formatClassTime";
import CalendarIcon from "../icons/calendar.svg";

type Props = {
  classListing: ClassListing;
  class?: string;
};

const { classListing, class: className } = Astro.props;

const formattedClassDate = formatClassDateRange(classListing);
---

<div
  class="rounded overflow-hidden shadow-lg p-2 bg-peach flex flex-col gap-4 flex-1 min-w-[315px] max-w-[500px]"
  class:list={className}
>
  <LinkedImage
    listingImageSrc={classListing.image}
    listingTitle={classListing.name}
    href={classListing.listingUrl}
    width={724}
    height={407}
    class="w-full"
  />

  <div class="flex flex-col gap-4 px-2 text-lg max-h-[500px]">
    <div
      class="flex items-center gap-2 border-b-2 border-light-purple text-primary-purple w-fit mr-auto py-4"
    >
      <CalendarIcon name="calendar" class="size-5" />

      <p class="font-serif font-semibold">
        {formattedClassDate}
      </p>
    </div>

    {
      classListing.classHeader ? (
        <p class="font-serif font-bold text-xl mb-2">
          {classListing.classHeader}
        </p>
      ) : null
    }

    {
      classListing.classDescription ? (
        <div
          class="wysiwyg overflow-auto"
          set:html={documentToHtmlString(classListing.classDescription)}
        />
      ) : null
    }
  </div>

  <CoralButtonLink href={classListing.listingUrl} class="w-full min-w-full">
    Learn More
  </CoralButtonLink>
</div>
